set(EXTERNAL_HEADERS
    ${EXTERN_ROOT}/DIA2Dump/Callback.h
    ${EXTERN_ROOT}/DIA2Dump/dia2dump.h
    ${EXTERN_ROOT}/DIA2Dump/PrintSymbol.h
    ${EXTERN_ROOT}/DIA2Dump/regs.h
    ${EXTERN_ROOT}/multicore/common/autoresetevent.h
    ${EXTERN_ROOT}/multicore/common/autoreseteventcondvar.h
    ${EXTERN_ROOT}/multicore/common/benaphore.h
    ${EXTERN_ROOT}/multicore/common/bitfield.h
    ${EXTERN_ROOT}/multicore/common/diningphilosophers.h
    ${EXTERN_ROOT}/multicore/common/inmemorylogger.h
    ${EXTERN_ROOT}/multicore/common/rwlock.h
    ${EXTERN_ROOT}/multicore/common/sema.h
    ${EXTERN_ROOT}/peparse/nt-headers.h
    ${EXTERN_ROOT}/peparse/parse.h
    ${EXTERN_ROOT}/peparse/to_string.h
)

set(EXTERNAL_SOURCES
    ${EXTERN_ROOT}/DIA2Dump/dia2dump.cpp
    ${EXTERN_ROOT}/DIA2Dump/PrintSymbol.cpp
    ${EXTERN_ROOT}/DIA2Dump/regs.cpp
    ${EXTERN_ROOT}/multicore/common/inmemorylogger.cpp
    ${EXTERN_ROOT}/peparse/buffer.cpp
    ${EXTERN_ROOT}/peparse/dump.cpp
    ${EXTERN_ROOT}/peparse/parse.cpp
    ${EXTERN_ROOT}/xxHash-r42/xxhash.c
)

source_group("External\\Header Files" FILES ${EXTERNAL_HEADERS})
source_group("External\\Source Files" FILES ${EXTERNAL_SOURCES})

set(HEADERS
    BaseTypes.h
    BlockChain.h
    Callstack.h
    CallstackTypes.h
    Capture.h
    Context.h
    ContextSwitch.h
    Core.h
    CoreApp.h
	CrashHandler.h
    DiaManager.h
    DiaParser.h
    Diff.h
    EventBuffer.h
    EventCallbacks.h
    EventClasses.h
    EventGuid.h
    EventTracer.h
    EventUtils.h
    FunctionStats.h
    Hashing.h
    Hijacking.h
    Injection.h
	Log.h
    LogInterface.h
    MemoryTracker.h
	Message.h
    MiniDump.h
    ModuleManager.h
	OrbitAsio.h
    OrbitDbgHelp.h
    OrbitDia.h
    OrbitFunction.h
    OrbitLib.h
    OrbitModule.h
    OrbitProcess.h
    OrbitRule.h
    OrbitSession.h
    OrbitThread.h
    OrbitType.h
    OrbitUnreal.h
    Params.h
	Path.h
    Pdb.h
	PrintVar.h
    ProcessUtils.h
	Profiling.h
    RingBuffer.h
    SamplingProfiler.h
    ScopeTimer.h
    Serialization.h
	SerializationMacros.h
    SymbolUtils.h
    Tcp.h
    TcpClient.h
    TcpEntity.h
    TcpServer.h
	TcpForward.h
	Threading.h
    TimerManager.h
	TypeInfoStructs.h
    Utils.h
    Variable.h
    VariableTracing.h
    Version.h
)

set(SOURCES
    Callstack.cpp
    Capture.cpp
    ContextSwitch.cpp
    Core.cpp
    CoreApp.cpp
	CrashHandler.cpp
    DiaManager.cpp
    DiaParser.cpp
    Diff.cpp
    EventBuffer.cpp
    EventCallbacks.cpp
    EventTracer.cpp
    EventUtils.cpp
    FunctionStats.cpp
	Hijacking.cpp
    Injection.cpp
	Log.cpp
    LogInterface.cpp
    MemoryTracker.cpp
	Message.cpp
    MiniDump.cpp
    ModuleManager.cpp
	OrbitAsio.cpp
    OrbitDia.cpp
    OrbitFunction.cpp
    OrbitLib.cpp
    OrbitModule.cpp
    OrbitProcess.cpp
    OrbitRule.cpp
    OrbitSession.cpp
    OrbitThread.cpp
    OrbitType.cpp
    OrbitUnreal.cpp
    Params.cpp
	Path.cpp
    Pdb.cpp
    ProcessUtils.cpp
    Profiling.cpp
    SamplingProfiler.cpp
    ScopeTimer.cpp
    SymbolUtils.cpp
    Tcp.cpp
    Tcp.cpp
    TcpClient.cpp
    TcpEntity.cpp
    TcpServer.cpp
    TimerManager.cpp
	Utils.cpp
    #TypeInfo.cpp
    Variable.cpp
    VariableTracing.cpp
    Version.cpp
)

source_group("Header Files" FILES ${HEADERS})
source_group("Source Files" FILES ${SOURCES})

add_library(OrbitCore STATIC
    ${SOURCES} ${EXTERNAL_SOURCES}
    ${HEADERS} ${EXTERNAL_HEADERS}
)

target_include_directories(OrbitCore
PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CEREAL_INCLUDE_DIR}
    ${EXTERN_ROOT}/concurrentqueue
    ${EXTERN_ROOT}/multicore/common/
    ${EXTERN_ROOT}/xxHash-r42
    ${EXTERN_ROOT}/oqpi/include
    ${EXTERN_ROOT}/DIA2Dump/
    ${EXTERN_ROOT}/breakpad/src/
    ${EXTERN_ROOT}/minhook/include/
    ${DIASDKDir}/include
PRIVATE
    ${BREAKPAD_INCLUDE_DIR}
)

target_link_libraries(OrbitCore
    dbghelp.lib
    ${BREAKPAD_LIBRARIES}
)
